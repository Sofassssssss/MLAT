# MLAT
— технология, позволяющая определять местоположение самолётов или иных воздушных судов (ВС) без использования дополнительного к имеющемуся оборудованию на ВС.
## Сборка
```bash
sudo apt-get install libgtest-dev
mkdir build
cd build
> conan_paths.cmake
cmake ..
```
## Запуск
Для запуска необходимо запустить исполняемый файл simulation и выполнить run-plotter.sh

## Описание модели.
Пусть самолет имеет координаты (*x, y, z*), а *i*-aя вышка имеет координаты (*x<sub>i</sub>, y<sub>i</sub>, z<sub>i</sub>*). Всего пусть задано *n > 3* вышек, тогда есть 
$$ C_n^k = \frac{n(n-1)}{2} $$
способов выбрать две из них. Обозначим, расстояние от самолета до *i*-ой вышки как *d<sub>i</sub>*. Расстояние от судна до *j*-ой вышки, соответственно, как *d<sub>j</sub>*. Соответсвующие расстояния выражаются по формулам
$$
d_i = \sqrt{(x-x_i)^2 + (y-y_i)^2 + (z-z_i)^2}, \\ 
d_j = \sqrt{(x-x_j)^2 + (y-y_j)^2 + (z-z_j)^2}.\\
$$
Зададим функцию *d*<sub>*ij*</sub>(*x, y, z*), как расстояние между вышками *i* и *j*, тогда
$$
d_{ij}(x,y,z) = |d_i - d_j| = \left | \sqrt{(x-x_i)^2 + (y-y_i)^2 + (z-z_i)^2} - \sqrt{(x-x_j)^2 + (y-y_j)^2 + (z-z_j)^2} \right |.
$$
С другой стороны, нетрудно получить, что
$$
d_i = ct_i,
$$
где *t<sub>i<sub>* является временем, за которое сигнал доходит от самолета, до вышки, тогда обозначим 
$$
d_{ij} = c|t_i - t_j| = c\Delta t_{ij}, 
$$
где *c* - скорость распространения сигнала, в нашем случае это скорость света, а разница времен есть ни что иное, как Time Difference of Arrival (TDOA), эта информация является известной нам, так как её мы получаем с вышек.
## Постановка задачи
Используя, описанную модель вычислить координаты самолета при известных Time Of Arrival (TOA).
## Решение
Первоочередно перейдем от TOA, к TDOA. Далее, ясно, что
$$
d_{ij}(x,y,z) = d_{ij} \Leftrightarrow f_{ij}(x,y,z) \equiv d_{ij}(x,y,z) - d_{ij} = 0,
$$
перебрав все возможные комбинации *i* и *j*, получим систему функций *f(x, y, z) = (f<sub>11</sub>, ..., f<sub>n(n-1)</sub>)*. Нетрудно догадаться, что задача состоит в поиске таких параметров *(x, y, z)*, что *f(x, y, z) = 0*. Построенная система уравнений является переопределенной. Она содержит всего 3 неизвестных, а вышек, как минимум 4, то есть всего 6 уравнений. 

Применим метод наименьших квадратов (МНК):
$$
S(x,y,z) = \left | \left | f(x,y,z) \right | \right | _2^2 = \sum_{i,j}f_{ij}^2(x,y,z).
$$ 
Будем искать такие решения, которые будут минимизировать написанную сумму, для этого применим алгоритм Гаусса-Ньютона, обозначив за *x* вектор решения, получим:
$$
x^{(k+1)} = x^{(k)} - (J_f^TJ_f)^{-1}J_f^T \cdot x^{(k)},
$$
где *J<sub>f<sub>* - матрица Якоби для системы *f*. А произведение матриц в вычитаемом есть псевдообратная матрица к матрице Якоби, которую можно вычислить с помощью QR разложения.
